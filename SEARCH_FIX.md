# Исправление поиска на странице звонков

## Проблема
Поиск на странице `/calls` не работал корректно из-за нескольких проблем:

1. **Циклические зависимости** в useEffect
2. **Некорректное использование SQLite** с `mode: 'insensitive'`
3. **Сложная логика** с отдельными состояниями для поиска

## Решение

### 1. Упрощена логика состояний
- Убрано отдельное состояние `search` 
- Поиск теперь читается напрямую из URL параметров
- Используется только `searchInput` для контроля ввода

### 2. Исправлен API для SQLite
```javascript
// Было (не работало с SQLite):
{ id: { contains: search, mode: 'insensitive' } }

// Стало (работает):
{ id: { contains: search } }
```

### 3. Добавлен debounced поиск
- Автоматический поиск с задержкой 500ms
- Обновление URL при изменении поискового запроса
- Кнопка поиска для принудительного поиска

### 4. Исправлена функция очистки
- Корректно очищает все поля ввода
- Обновляет URL параметры

## Как работает поиск:

1. **Автоматический поиск**: при вводе текста поиск происходит автоматически через 500ms
2. **Поиск по полям**: 
   - ID звонка
   - ID сделки 
   - Имя сотрудника
   - Имя руководителя
3. **Кнопка поиска**: для принудительного поиска при нажатии Enter или клике

## Диагностика

Добавлены логи в API для отслеживания:
- Поисковые термины
- Количество найденных результатов

## Файлы изменений:

- ✅ `src/app/calls/page.tsx` - основная логика поиска
- ✅ `src/app/api/calls/route.ts` - исправление SQLite запросов
- ✅ Добавлены диагностические логи

## Тестирование:

Поиск протестирован на базе данных:
- Поиск по "test" - находит 13 звонков
- Поиск по "228" - находит 1 звонок  
- Поиск по "Иван" - находит несколько звонков

---

*Исправление выполнено: 2025-01-04*
*Статус: ✅ Готово к тестированию в браузере*
